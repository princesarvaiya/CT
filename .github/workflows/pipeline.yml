name: Deploy based on env
on:
    push: 
     branches: 
        - main

jobs: 
   
  
  build:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
     - uses: actions/checkout@v3
     - name: Get branch name
       id: branch_name
       run: echo "::set-output name=branch_name::${{ github.ref }}"
     
     - name: Extract folder name
       run: |
        
        branch_name=${{ steps.branch_name.outputs.branch_name }}
        folder_name=${branch_name##*/}
        echo "Folder name: $folder_name"
     
   #  - name: reading values from shell
    #   run: ./source.sh
     #  shell: bas
          
    
               
          
     - name: Deploy Helm
       uses: aws-actions/configure-aws-credentials@v1
       
     - name: adding folder  
       run: |
         echo "aws_access_key_id = ${{ secrets.AWS_ACCESS_KEY_ID }}" >> ~/.aws/credentials
         echo "aws_secret_access_key = ${{ secrets.AWS_SECRET_ACCESS_KEY }}" >> ~/.aws/credentials
         aws eks update-kubeconfig --name myekscluster
         kubectl get pods
         kubectl get nodes
         # cd $folder_name
         # helm upgrade ${{ secrets.HELM_NAME }} -f values.yaml -f deployment.yaml $folder_name/${{ secrets.HELM_NAME }}

        
        
      
      
